@page "/queue"

<PageTitle>Queue - Spotigneto</PageTitle>

@inject Frontend.Services.Playback.PlaybackService Playback
@inject IJSRuntime JS
@inject HttpClient Http

<div class="queue-page">
    <!-- Header Section -->
    <section class="queue-header">
      <h1 class="queue-title">Queue</h1>
      <div class="queue-stats">
        <span class="queue-count">@queueTracks.Count tracks in queue</span>
            <span class="queue-separator">�</span>
<span class="queue-duration">@totalDuration total</span>
    </div>
      <div class="queue-actions">
            <button class="action-btn shuffle-btn" @onclick="ShuffleQueue" aria-label="Shuffle Queue">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
         <path d="M11 2h3v3M2 8.5h12M11 14h3v-3M14 2l-3.5 3.5M14 14l-3.5-3.5" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
           Shuffle
            </button>
   <button class="action-btn clear-btn" @onclick="ClearQueue" aria-label="Clear Queue">
           <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                 <path d="M2 4h12M6 2h4" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
     <path d="M5 4v8a1 1 0 001 1h4a1 1 0 001-1V4" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M6.5 7v4M9.5 7v4" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round"/>
         </svg>
              Clear Queue
      </button>
        <button class="action-btn" @onclick="CycleRepeat" aria-label="Repeat Mode">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor">
            <path d="M4 4h6a3 3 0 013 3v1" stroke-width="1.5" stroke-linecap="round"/>
            <path d="M12 12H6a3 3 0 01-3-3V8" stroke-width="1.5" stroke-linecap="round"/>
            <path d="M4 2l-2 2 2 2" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 10l2 2-2 2" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Repeat: @repeatLabel
        </button>
        <button class="action-btn" @onclick="PlayAll" aria-label="Play All">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M5 3v10l8-5z" />
          </svg>
          Play All
        </button>
        </div>
    </section>

    <!-- Now Playing Section -->
    <section class="now-playing-section">
        <h2 class="section-title">Now Playing</h2>
        @if (nowPlaying != null)
        {
  <div class="now-playing-card">
            <div class="now-playing-content">
          <div class="track-cover-large" style="background: @nowPlaying.Gradient;">
   @if (!string.IsNullOrEmpty(nowPlaying.ImageUrl))
         {
                <img src="@nowPlaying.ImageUrl" alt="@nowPlaying.Title" />
            }
   </div>
       <div class="now-playing-info">
  <div class="track-title-large">@nowPlaying.Title</div>
            <div class="track-metadata">
   <span class="track-artist-large">@nowPlaying.Artist</span>
           <span class="metadata-separator">�</span>
      <span class="track-album-large">@nowPlaying.Album</span>
      </div>
<div class="playback-controls">
         <div class="progress-section">
               <div class="time-current">@currentTime</div>
       <div class="progress-bar-container">
     <div class="progress-bar">
    <div class="progress-bar-fill" style="width: @progressPercent%;"></div>
        </div>
            </div>
          <div class="time-total">@totalTime</div>
   </div>
  <div class="control-buttons">
  <button class="control-btn play-btn-large" @onclick="TogglePlay" aria-label="Play/Pause">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
         <circle cx="10" cy="10" r="10" fill="#1db954" />
        <path d="M8 6v8l6-4z" fill="#000" />
          </svg>
            </button>
              <button class="control-btn icon-btn" @onclick="SkipPrevious" aria-label="Previous">
     <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
       <path d="M15 4v12L7 10l8-6zM4 4h2v12H4V4z" />
     </svg>
       </button>
              <button class="control-btn skip-btn" @onclick="SkipNext" aria-label="Skip">
     <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
     <path d="M5 4v12l8-6-8-6zM14 4h2v12h-2V4z" />
       </svg>
       </button>
           <button class="control-btn icon-btn" @onclick="ToggleLike" aria-label="Like">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor">
     <path d="M10 17s-6-4-6-7.5c0-2 1.5-3.5 3.5-3.5 1.5 0 2.5 1 2.5 1s1-1 2.5-1C14.5 6 16 7.5 16 9.5c0 3.5-6 7.5-6 7.5z" stroke-width="1.5"/>
 </svg>
      </button>
      <button class="control-btn icon-btn" @onclick="AddToPlaylist" aria-label="Add to playlist">
   <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
   <path d="M10 5v10M5 10h10" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round"/>
 </svg>
             </button>
     <button class="control-btn icon-btn" aria-label="More options">
           <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
     <circle cx="10" cy="5" r="1.5" />
    <circle cx="10" cy="10" r="1.5" />
     <circle cx="10" cy="15" r="1.5" />
      </svg>
        </button>
          </div>
  </div>
   </div>
    </div>
            </div>
}
    </section>

    <!-- Queue List Section -->
    <section class="queue-list-section">
        <h2 class="section-title">Next in Queue</h2>
        <div class="queue-table">
            <div class="queue-table-header">
     <div class="header-number">#</div>
       <div class="header-title">TITLE</div>
   <div class="header-album">ALBUM</div>
       <div class="header-duration">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor">
   <circle cx="8" cy="8" r="6.5" stroke-width="1.5" />
    <path d="M8 5v3l2 2" stroke-width="1.5" stroke-linecap="round"/>
         </svg>
         </div>
          </div>

      <div class="queue-table-body">
           @foreach (var track in queueTracks)
 {
      <div class="queue-track-row @(track.Id == hoveredTrackId ? "hovered" : "")" 
 @onmouseenter="() => hoveredTrackId = track.Id"
             @onmouseleave="() => hoveredTrackId = null" @ondblclick="() => PlayTrack(track)">
        <div class="track-number">
            @if (hoveredTrackId == track.Id)
   {
    <button class="play-icon-btn" @onclick="() => PlayTrack(track)" aria-label="Play @track.Title">
           <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M5 3v10l8-5z" />
    </svg>
     </button>
              }
    else
           {
           <span>@track.Position</span>
             }
</div>
      <div class="track-main">
         <div class="track-cover" style="background: @track.Gradient;">
       @if (!string.IsNullOrEmpty(track.ImageUrl))
          {
  <img src="@track.ImageUrl" alt="@track.Title" />
      }
     </div>
                <div class="track-info">
           <div class="track-title">@track.Title</div>
        <div class="track-artist">@track.Artist</div>
             </div>
       </div>
       <div class="track-album">@track.Album</div>
  <div class="track-duration">@track.Duration</div>
        </div>
     }
            </div>
        </div>
    </section>

    <!-- Recently Played Section -->
    <section class="recently-played-section">
     <h2 class="section-title">Recently Played</h2>
 <div class="queue-table">
      <div class="queue-table-header">
     <div class="header-number">#</div>
       <div class="header-title">TITLE</div>
  <div class="header-album">ALBUM</div>
             <div class="header-duration">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor">
           <circle cx="8" cy="8" r="6.5" stroke-width="1.5" />
    <path d="M8 5v3l2 2" stroke-width="1.5" stroke-linecap="round"/>
           </svg>
   </div>
      </div>

     <div class="queue-table-body">
        @foreach (var track in recentlyPlayedTracks)
                {
      <div class="queue-track-row @(track.Id == hoveredTrackId ? "hovered" : "")" 
            @onmouseenter="() => hoveredTrackId = track.Id"
           @onmouseleave="() => hoveredTrackId = null">
      <div class="track-number">
                @if (hoveredTrackId == track.Id)
            {
      <button class="play-icon-btn" @onclick="() => PlayTrack(track)" aria-label="Play @track.Title">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
  <path d="M5 3v10l8-5z" />
       </svg>
       </button>
             }
           else
        {
   <span>@track.Position</span>
  }
     </div>
           <div class="track-main">
   <div class="track-cover" style="background: @track.Gradient;">
          @if (!string.IsNullOrEmpty(track.ImageUrl))
        {
         <img src="@track.ImageUrl" alt="@track.Title" />
         }
            </div>
        <div class="track-info">
            <div class="track-title">@track.Title</div>
          <div class="track-artist">@track.Artist</div>
          </div>
          </div>
           <div class="track-album">@track.Album</div>
       <div class="track-duration">@track.Duration</div>
             </div>
}
        </div>
        </div>
    </section>
</div>

@code {

    private Track? nowPlaying;
    private List<Track> queueTracks = new();
    private List<Track> recentlyPlayedTracks = new();
    private int? hoveredTrackId;
    private string totalDuration = "21min total";
    private string currentTime = "1:42";
    private string totalTime = "0:00";
    private int progressPercent = 48;
    private bool isPlaying = true;

    protected override void OnInitialized()
    {
        // Hook service state changes to refresh UI
        Playback.StateChanged += OnPlaybackStateChanged;

        InitializeNowPlaying();
        InitializeQueue();
        InitializeRecentlyPlayed();
    }

    protected override async Task OnInitializedAsync()
    {
        // Load real songs from backend to allow playing any track
        await LoadSongsFromBackend();
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            Playback.Initialize(JS);
            // Attach JS audio events to this component
            var mod = await JS.InvokeAsync<IJSObjectReference>("import", "/js/audio.js");
            await mod.InvokeVoidAsync("attach", DotNetObjectReference.Create(this));
        }
    }

    private void InitializeNowPlaying()
    {
        nowPlaying = new Track
        {
            Id = 0,
            Position = 0,
            Title = "Say My Name",
          Artist = "ODESZA, Zyra",
        Album = "In Return",
        Duration = "3:59",
  ImageUrl = "https://images.unsplash.com/photo-1470225620780-dba8ba36b745?w=300&h=300&fit=crop",
          Gradient = "linear-gradient(135deg, #4158d0 0%, #c850c0 100%)"
        };
    }

    private void InitializeQueue()
    {
        queueTracks = new List<Track>
    {
     new Track { Id = 1, Position = 1, Title = "A Moment Apart", Artist = "ODESZA", Album = "A Moment Apart", Duration = "3:33", ImageUrl = "https://images.unsplash.com/photo-1514320291840-2e0a9bf2a9ae?w=300&h=300&fit=crop", Gradient = "linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%)" },
       new Track { Id = 2, Position = 2, Title = "It's Only", Artist = "ODESZA, Zyra", Album = "In Return", Duration = "4:47", ImageUrl = "https://images.unsplash.com/photo-1470225620780-dba8ba36b745?w=300&h=300&fit=crop", Gradient = "linear-gradient(135deg, #4158d0 0%, #c850c0 100%)" },
            new Track { Id = 3, Position = 3, Title = "Line of Sight", Artist = "ODESZA, Wynne, Mansionair", Album = "A Moment Apart", Duration = "4:29", ImageUrl = "https://images.unsplash.com/photo-1514320291840-2e0a9bf2a9ae?w=300&h=300&fit=crop", Gradient = "linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%)" },
            new Track { Id = 4, Position = 4, Title = "Bloom", Artist = "ODESZA", Album = "In Return", Duration = "4:34", ImageUrl = "https://images.unsplash.com/photo-1470225620780-dba8ba36b745?w=300&h=300&fit=crop", Gradient = "linear-gradient(135deg, #4158d0 0%, #c850c0 100%)" }
        };

        // Seed PlaybackService with current queue if empty (client-side only)
        if (Playback.Queue.Count == 0)
        {
            foreach (var t in queueTracks)
            {
                var ti = new Frontend.Services.Playback.TrackItem
                {
                    Id = string.IsNullOrEmpty(t.IdString) ? t.Id.ToString() : t.IdString,
                    Title = t.Title,
                    Artist = t.Artist,
                    Album = t.Album,
                    DurationSeconds = ParseDurationSeconds(t.Duration),
                    ImageUrl = t.ImageUrl,
                    Gradient = t.Gradient
                };
                Playback.AddToQueue(ti);
            }
        }
    }

    private async Task LoadSongsFromBackend()
    {
        try
        {
            var items = await Http.GetFromJsonAsync<List<CanzoneDto>>("api/Canzone/canzoni");
            if (items == null || items.Count == 0) return;

            // Map backend songs to existing UI Track model without changing markup
            queueTracks = items.Select((s, idx) => new Track
            {
                IdString = s.Id,
                Id = idx + 1,
                Position = idx + 1,
                Title = s.Nome,
                Artist = string.Empty,
                Album = string.Empty,
                Duration = string.IsNullOrWhiteSpace(s.Durata) ? Frontend.Services.Playback.TrackItem.FormatDuration(s.Secondi) : s.Durata,
                ImageUrl = string.Empty,
                Gradient = "linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%)"
            }).ToList();

            // Seed playback service with backend data
            Playback.ClearQueue();
            foreach (var t in queueTracks)
            {
                var ti = new Frontend.Services.Playback.TrackItem
                {
                    Id = t.IdString,
                    Title = t.Title,
                    Artist = t.Artist,
                    Album = t.Album,
                    DurationSeconds = ParseDurationSeconds(t.Duration),
                    ImageUrl = t.ImageUrl,
                    Gradient = t.Gradient
                };
                Playback.AddToQueue(ti);
            }

            UpdateTotalDuration();
            StateHasChanged();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Errore caricando canzoni dal backend: {ex.Message}");
        }
    }

    // DTO locale per evitare dipendenze dal progetto Backend
    private class CanzoneDto
    {
        public string Id { get; set; } = string.Empty;
        public string Nome { get; set; } = string.Empty;
        public string? File { get; set; }
        public string Genere { get; set; } = string.Empty;
        public string Sottogenere { get; set; } = string.Empty;
        public string Durata { get; set; } = string.Empty;
        public int Secondi { get; set; }
    }

    private void InitializeRecentlyPlayed()
    {
        recentlyPlayedTracks = new List<Track>
        {
            new Track { Id = 5, Position = 1, Title = "Higher Ground", Artist = "ODESZA", Album = "A Moment Apart", Duration = "3:46", ImageUrl = "https://images.unsplash.com/photo-1514320291840-2e0a9bf2a9ae?w=300&h=300&fit=crop", Gradient = "linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%)" },
     new Track { Id = 6, Position = 2, Title = "Late Night", Artist = "ODESZA", Album = "In Return", Duration = "3:52", ImageUrl = "https://images.unsplash.com/photo-1470225620780-dba8ba36b745?w=300&h=300&fit=crop", Gradient = "linear-gradient(135deg, #4158d0 0%, #c850c0 100%)" }
   };
    }

    private async Task PlayTrack(Track track)
    {
        Console.WriteLine($"Playing: {track.Title} by {track.Artist}");
        nowPlaying = track;
        // Use in-memory queue and audio service; avoid backend until streaming is needed
        var item = new Frontend.Services.Playback.TrackItem
        {
            Id = string.IsNullOrEmpty(track.IdString) ? track.Id.ToString() : track.IdString,
            Title = track.Title,
            Artist = track.Artist,
            Album = track.Album,
            DurationSeconds = ParseDurationSeconds(track.Duration),
            ImageUrl = track.ImageUrl,
            Gradient = track.Gradient
        };
        await Playback.PlayAsync(item);
        isPlaying = true;
        UpdateProgressFromService();
        StateHasChanged();
    }

    private void PlayAll()
    {
        // Play the first track in the queue using the service
        var first = Playback.Queue.FirstOrDefault();
        if (first != null)
        {
            _ = Playback.PlayAsync(first);
            isPlaying = true;
        }
    }

    private void ShuffleQueue()
    {
        Playback.ShuffleQueue();
        // Mirror service state locally from Playback.Queue without changing styles
        queueTracks = Playback.Queue.Select((ti, idx) => new Track
        {
            IdString = ti.Id,
            Id = idx + 1,
            Position = idx + 1,
            Title = ti.Title,
            Artist = ti.Artist,
            Album = ti.Album,
            Duration = Frontend.Services.Playback.TrackItem.FormatDuration(ti.DurationSeconds),
            ImageUrl = ti.ImageUrl,
            Gradient = ti.Gradient
        }).ToList();
        Console.WriteLine("Queue shuffled");
        StateHasChanged();
    }

    private void ClearQueue()
    {
        Playback.ClearQueue();
        queueTracks.Clear();
        Console.WriteLine("Queue cleared");
        StateHasChanged();
    }

    private async Task TogglePlay()
    {
        await Playback.TogglePlayAsync();
        isPlaying = Playback.IsPlaying;
        Console.WriteLine(isPlaying ? "Playing" : "Paused");
    }

    private async Task SkipNext()
    {
        await Playback.SkipNextAsync();
        // Update local nowPlaying from service
        var np = Playback.NowPlaying;
        if (np != null)
        {
            nowPlaying = new Track
            {
                IdString = np.Id,
                Title = np.Title,
                Artist = np.Artist,
                Album = np.Album,
                Duration = Frontend.Services.Playback.TrackItem.FormatDuration(np.DurationSeconds),
                ImageUrl = np.ImageUrl,
                Gradient = np.Gradient
            };
            isPlaying = Playback.IsPlaying;
            UpdateProgressFromService();
        }
    }

    private async Task SkipPrevious()
    {
        if (Playback.Queue.Count == 0) return;
        var idx = Playback.NowIndex;
        if (idx > 0)
        {
            var prev = Playback.Queue[idx - 1];
            await Playback.PlayAsync(prev);
            isPlaying = true;
            UpdateProgressFromService();
        }
        else if (Playback.Repeat == Frontend.Services.Playback.RepeatMode.All && Playback.Queue.Count > 0)
        {
            var prev = Playback.Queue.Last();
            await Playback.PlayAsync(prev);
            isPlaying = true;
            UpdateProgressFromService();
        }
    }

    private void ToggleLike()
    {
  Console.WriteLine("Toggled like");
    }

    private void AddToPlaylist()
    {
        Console.WriteLine("Add to playlist");
    }

    private void OnPlaybackStateChanged()
    {
        isPlaying = Playback.IsPlaying;
        UpdateProgressFromService();
        InvokeAsync(StateHasChanged);
    }

    private void UpdateProgressFromService()
    {
        currentTime = Playback.CurrentTimeText;
        progressPercent = Playback.ProgressPercent;
        totalTime = Playback.TotalTimeText;
        // Keep totalDuration label text as-is to avoid layout changes
    }

    private void CycleRepeat()
    {
        // Cycle through None -> All -> One -> None
        var next = Playback.Repeat switch
        {
            Frontend.Services.Playback.RepeatMode.None => Frontend.Services.Playback.RepeatMode.All,
            Frontend.Services.Playback.RepeatMode.All => Frontend.Services.Playback.RepeatMode.One,
            _ => Frontend.Services.Playback.RepeatMode.None
        };
        Playback.SetRepeat(next);
        repeatLabel = next switch
        {
            Frontend.Services.Playback.RepeatMode.None => "Off",
            Frontend.Services.Playback.RepeatMode.All => "All",
            Frontend.Services.Playback.RepeatMode.One => "One",
            _ => "Off"
        };
    }

    [JSInvokable]
    public void OnAudioTimeUpdate(double current, double total)
    {
        Playback.UpdateProgress(current, total);
    }

    [JSInvokable]
    public async Task OnAudioEnded()
    {
        await Playback.SkipNextAsync();
    }

    private static int ParseDurationSeconds(string duration)
    {
        // Expect MM:SS; fallback to 0
        var parts = duration.Split(':');
        if (parts.Length == 2 && int.TryParse(parts[0], out var m) && int.TryParse(parts[1], out var s))
        {
            return m * 60 + s;
        }
        return 0;
    }

    public void Dispose()
    {
        Playback.StateChanged -= OnPlaybackStateChanged;
    }

    private class Track
    {
        public int Id { get; set; }
        public string IdString { get; set; } = string.Empty;
        public int Position { get; set; }
        public string Title { get; set; } = string.Empty;
        public string Artist { get; set; } = string.Empty;
        public string Album { get; set; } = string.Empty;
        public string Duration { get; set; } = string.Empty;
        public string ImageUrl { get; set; } = string.Empty;
        public string Gradient { get; set; } = string.Empty;
    }

    private void UpdateTotalDuration()
    {
        var totalSeconds = queueTracks.Sum(t => ParseDurationSeconds(t.Duration));
        var mins = totalSeconds / 60;
        totalDuration = $"{mins}min total";
    }

    private string repeatLabel = "Off";
}

<style>
    .queue-page {
        color: #fff;
        padding: 0;
        max-width: 100%;
    }

    .queue-header {
        padding: 24px 24px 24px;
        margin-bottom: 24px;
    }

  .queue-title {
        font-size: 32px;
   font-weight: 700;
        margin: 0 0 8px 0;
        color: #fff;
        letter-spacing: -0.02em;
    }

    .queue-stats {
     display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 20px;
        font-size: 13px;
        color: #b3b3b3;
    }

    .queue-count {
      font-weight: 400;
    }

    .queue-separator {
  font-weight: 700;
    }

    .queue-duration {
        font-weight: 400;
    }

.queue-actions {
        display: flex;
        gap: 10px;
    }

    .action-btn {
        display: flex;
      align-items: center;
        gap: 8px;
  padding: 8px 18px;
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.15);
        background-color: rgba(0, 0, 0, 0.4);
  color: #fff;
   font-size: 13px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .action-btn:hover {
        background-color: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.3);
        transform: scale(1.02);
    }

    .action-btn svg {
     flex-shrink: 0;
    }

    .section-title {
        font-size: 18px;
font-weight: 700;
        margin: 0 0 16px 0;
        padding: 0 24px;
        color: #fff;
    }

    .now-playing-section {
margin-bottom: 32px;
        padding: 0 24px;
    }

    .now-playing-card {
        background: rgba(40, 40, 40, 0.6);
        border-radius: 8px;
      padding: 20px;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .now-playing-content {
        display: flex;
   gap: 20px;
        align-items: flex-start;
    }

    .track-cover-large {
        width: 80px;
        height: 80px;
        border-radius: 6px;
        flex-shrink: 0;
 overflow: hidden;
    }

    .track-cover-large img {
     width: 100%;
height: 100%;
        object-fit: cover;
    }

    .now-playing-info {
      flex: 1;
        display: flex;
        flex-direction: column;
    gap: 8px;
    }

    .track-title-large {
   font-size: 16px;
        font-weight: 600;
   color: #fff;
        margin-bottom: 4px;
    }

    .track-metadata {
        display: flex;
      align-items: center;
    gap: 6px;
    font-size: 13px;
   color: #b3b3b3;
        margin-bottom: 12px;
    }

    .track-artist-large {
        color: #fff;
    }

    .metadata-separator {
        color: #666;
  }

    .track-album-large {
  color: #b3b3b3;
    }

    .playback-controls {
display: flex;
flex-direction: column;
        gap: 12px;
    }

    .progress-section {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .time-current,
    .time-total {
      font-size: 12px;
        color: #b3b3b3;
        font-variant-numeric: tabular-nums;
        min-width: 32px;
    }

    .time-total {
        text-align: right;
    }

    .progress-bar-container {
        flex: 1;
        height: 4px;
        background-color: #4d4d4d;
        border-radius: 2px;
        cursor: pointer;
        position: relative;
    }

    .progress-bar-container:hover {
      height: 6px;
    }

    .progress-bar {
        width: 100%;
        height: 100%;
        position: relative;
    }

    .progress-bar-fill {
        height: 100%;
        background-color: #1db954;
        border-radius: 2px;
        transition: width 0.1s linear;
    }

    .control-buttons {
        display: flex;
        align-items: center;
        gap: 12px;
  }

    .control-btn {
        background: transparent;
 border: none;
        color: #b3b3b3;
        cursor: pointer;
        padding: 4px;
display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
    }

    .control-btn:hover {
        color: #fff;
        transform: scale(1.1);
    }

    .play-btn-large svg circle {
        transition: fill 0.2s ease;
    }

.play-btn-large:hover svg circle {
fill: #1ed760;
    }

    .icon-btn {
        color: #b3b3b3;
    }

    .icon-btn:hover {
      color: #fff;
    }

    .queue-list-section,
    .recently-played-section {
    margin-bottom: 32px;
    }

    .queue-table {
        padding: 0 24px;
    }

    .queue-table-header {
     display: grid;
        grid-template-columns: 40px 1fr 180px 60px;
        gap: 16px;
     padding: 8px 12px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        margin-bottom: 4px;
        color: #b3b3b3;
        font-size: 11px;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.1em;
    }

    .header-number {
        text-align: center;
    }

    .header-title {
  padding-left: 60px;
    }

    .header-album {
        padding-left: 0;
    }

    .header-duration {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .queue-table-body {
        display: flex;
   flex-direction: column;
        gap: 2px;
    }

    .queue-track-row {
        display: grid;
   grid-template-columns: 40px 1fr 180px 60px;
        gap: 16px;
    align-items: center;
        padding: 8px 12px;
        border-radius: 4px;
        transition: background-color 0.2s ease;
    }

    .queue-track-row:hover {
        background-color: rgba(255, 255, 255, 0.08);
    }

    .track-number {
        display: flex;
 align-items: center;
        justify-content: center;
     color: #b3b3b3;
      font-size: 14px;
  font-weight: 400;
        min-width: 40px;
    }

    .play-icon-btn {
   background: transparent;
        border: none;
        color: #fff;
 cursor: pointer;
 padding: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
    }

    .play-icon-btn:hover {
        transform: scale(1.1);
    }

    .track-main {
        display: flex;
        align-items: center;
        gap: 12px;
        min-width: 0;
    }

    .track-cover {
    width: 40px;
      height: 40px;
        border-radius: 4px;
     flex-shrink: 0;
     overflow: hidden;
  }

    .track-cover img {
        width: 100%;
        height: 100%;
  object-fit: cover;
    }

    .track-info {
        flex: 1;
        min-width: 0;
    }

    .track-title {
 font-size: 15px;
    font-weight: 400;
        color: #fff;
      white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        margin-bottom: 4px;
    }

    .track-artist {
     font-size: 13px;
 color: #b3b3b3;
     white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .track-album {
        font-size: 13px;
        color: #b3b3b3;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .track-duration {
text-align: center;
        font-size: 13px;
      color: #b3b3b3;
      font-weight: 400;
        font-variant-numeric: tabular-nums;
    }

    @@media (max-width: 1200px) {
        .queue-table-header,
        .queue-track-row {
    grid-template-columns: 40px 1fr 150px 60px;
    }
    }

    @@media (max-width: 992px) {
        .queue-title {
          font-size: 28px;
     }

   .queue-table-header,
        .queue-track-row {
            grid-template-columns: 40px 1fr 60px;
        }

        .track-album,
        .header-album {
   display: none;
        }

        .now-playing-content {
   flex-direction: column;
        }

    .track-cover-large {
         width: 100%;
            height: 200px;
        }
    }

    @@media (max-width: 768px) {
        .queue-title {
     font-size: 24px;
  }

        .section-title {
      font-size: 16px;
        }

     .action-btn {
      font-size: 12px;
  padding: 6px 14px;
        }
    }

    @@media (max-width: 480px) {
        .queue-actions {
   flex-direction: column;
        }

        .action-btn {
   width: 100%;
            justify-content: center;
        }
    }

    .action-btn:focus-visible,
    .play-icon-btn:focus-visible,
    .control-btn:focus-visible {
        outline: 2px solid #1db954;
        outline-offset: 2px;
    }
</style>
